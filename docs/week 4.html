<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>CASA0023 Learning Diary - 4&nbsp; Week 4 policy: Transformative Shifts</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./week 6.html" rel="next">
<link href="./week 3.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./week 4.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Week 4 policy: Transformative Shifts</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">CASA0023 Learning Diary</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week 1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Week 1 Remote sensing: an Arial adventure</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week 2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Week 2 Xaringan: Crafting Stunning Presentations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week 3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Week 3 Correction: Refining the Lens</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week 4.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Week 4 policy: Transformative Shifts</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week 6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Week 5 GEE: Mapping the world</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week 7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Week 6 Classification I: Navigating Machine learning</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week 8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">week 7 classification: Indepth</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week 9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">week 8 SAR: Reveling SAR</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#summary" id="toc-summary" class="nav-link active" data-scroll-target="#summary"><span class="header-section-number">4.1</span> Summary</a></li>
  <li><a href="#application" id="toc-application" class="nav-link" data-scroll-target="#application"><span class="header-section-number">4.2</span> Application</a></li>
  <li><a href="#reflection" id="toc-reflection" class="nav-link" data-scroll-target="#reflection"><span class="header-section-number">4.3</span> Reflection</a></li>
  <li><a href="#reference" id="toc-reference" class="nav-link" data-scroll-target="#reference"><span class="header-section-number">4.4</span> Reference</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Week 4 policy: Transformative Shifts</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="summary" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="summary"><span class="header-section-number">4.1</span> Summary</h2>
<p>In week 4, the primary emphasis was on utilizing remote sensing to accomplish policy objectives. We were tasked with selecting a city and identifying policy challenges that could be addressed using remotely sensed data.</p>
<p>I am deeply intrigued by the observation and analysis of cities affected by conflict. I am convinced that leveraging satellite imagery to assess the economic, environmental, and social repercussions of war plays a vital role in formulating decisions that benefit the city’s well-being. This may help urban planners in implementing effective solutions for post-war urban development. Hence, I have chosen to study the impact of war on the socio-economic, environmental, and building damage aspects of Ukraine.</p>
<p>According to <strong>United Nations Urban agenda:</strong></p>
<ul>
<li><p>We recognize that urban form, infrastructure and building design are among the greatest drivers of cost and resource efficiencies, through the benefits of economy of scale and agglomeration and by fostering energy efficiency, renewable energy, <strong>resilience</strong>, productivity, <strong>environmental protection</strong> and sustainable growth in the <strong>urban economy</strong>.</p></li>
<li><p>sustainable management of natural resources in cities and human settlements in a manner that protects and improves the urban <strong>ecosystem</strong> and <strong>environmental services</strong>, <strong>reduces greenhouse gas emissions and air pollution</strong> and promotes disaster risk reduction and management,</p></li>
</ul>
<p>Also highlighted in the <strong>Sustainable Development Goals</strong> agenda:</p>
<p><strong>Goal 11:</strong> Make cities and human settlements inclusive, safe, <strong>resilient</strong> and sustainable.In fact, sustainable development in cities is critical to achieving most of Agenda 2030.</p>
</section>
<section id="application" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="application"><span class="header-section-number">4.2</span> Application</h2>
<p>Wars tend to have a series of effects and outcomes, the war on Ukraine has a massive impact on the economics of the country, just in the first year of the conflict Ukraine saw a devastating 30-35% decline in GDP, While there is a projected 0.5% GDP growth for 2023, it remains significantly below pre-war levels. The Ukraine economic deterioration is one of many side effects of war such as people displacement, infrastructure damage, pollution, and agriculture damage…. etc.</p>
<p>The focus of the Sustainable Development Goals (SDGs) and the new agenda is to prioritize the development of cities that exhibit resilience, environmental sustainability, and economic growth in urban areas. Therefore, it was appropriate to highlight Ukraine, a country in conflict, as a case study. This emphasis is necessary to navigate the crisis and ensure the well-being of its residents by fostering a post-war process that creates a more resilient city. This approach in Ukraine involves maintaining economic resilience, addressing environmental risks, and providing affordable housing for displaced people.</p>
<p>The use of remotely sensed data would be appropriate in this sensitive condition, as it can provide accurate information about the situation. This was shown by some of the studies conducted on Ukraine to monitor the socioeconomic change, air pollution, infrastructure damage, agriculture change assessment, and aid refugee relief operations. For this week, I will focus on a single paper while also recommending other remote sensing methods that could aid in studying the impact of wars. This paper details the method used for damage assessment : <strong><em>War Related Building Damage Assessment in Kyiv, Ukraine, Using Sentinel-1 Radar and Sentinel-2 Optical Images</em></strong> (Aimaiti, Koch 2022). In week 4 I’m only considering one paper but i will suggest other remote sensing methods that would help in studying the impact of wars.</p>
<p><u><strong>War Related Building Damage Assessment in Kyiv, Ukraine, Using Sentinel-1 Radar and Sentinel-2 Optical Images:</strong></u></p>
<p>In this study, medium-resolution satellite imagery was utilized because it is publicly available and capable of rapidly producing damage maps, which can serve as an initial reference for assessing damage.</p>
<p>Sentinel-1 and Sentinel-2 data were used assess building damage, a robust SAR log ratio of intensity method is utilized for Sentinel-1 data, and a texture analysis is conducted for Sentinel-2 data for damage assessment. To focus on urban areas and suppress changes from other features and landcover types, a built-up area mask is generated using OpenStreetMap building footprints and the World Settlement Footprint (WSF) dataset, respectively.</p>
<section id="methods" class="level4" data-number="4.2.0.1">
<h4 data-number="4.2.0.1" class="anchored" data-anchor-id="methods"><span class="header-section-number">4.2.0.1</span> Methods</h4>
<p>The workflow consists of four phases: data selection and pre-processing, change detection analysis using the log ratio of intensity and Gray Level Co-occurrence Matrix (GLCM) methods, determination of an optimal threshold for separating changed and unchanged areas, and validation of results using high-resolution WorldView images and the UNOSAT damage assessment map.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="policy 1.jpg" class="img-fluid figure-img" width="3000"></p>
<figcaption class="figure-caption"><strong>Figure (1):</strong> the processing workflow for building damage mapping using Sentinel-1 and Sentinel-2 images. Note: dif, AOI, and Tr refer to the difference, selected area for threshold determination, and threshold.</figcaption>
</figure>
</div>
<p><u><strong>SAR Intensity Analysis:</strong></u></p>
<p>A collapsed building exhibits a distinct backscatter structure compared to an intact one. Typically, strong backscattering diminishes or disappears after a building collapses due to a disaster. However, in partially damaged buildings, where sections of the wall and roof collapse, remaining walls, debris, and ground may form a corner reflector, resulting in strong double-bounce effects and increased backscattering intensity. This difference enables the identification of damaged and undamaged buildings using SAR backscattering intensity change detection. For this purpose, the study implemented the simple yet robust SAR log ratio of intensity method.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="policy 2.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption"><strong>Figure</strong> <strong>(2):</strong> schematic diagram of backscatter intensity from (a) intact buildings (b) destroyed buildings, and (c) partially damaged buildings in synthetic aperture radar (SAR) images; (a-1,a-2,b-1,b-2,c-1,c-2) are pre-and post-event Sentinel-1 images (19 February 2022 &amp; 8 April 2022); (a-3,b-3,c-3) are corresponding WorldView images (25 &amp; 31 March 2022).</figcaption>
</figure>
</div>
<p><u><strong>Optical Texture Analysis:</strong></u></p>
<p>In this study, the GLCM Mean was utilized to differentiate between damaged and undamaged buildings, This feature is particularly valuable for classifying landscapes, especially in building damage assessment. GLCM Mean represents interior texture, characterized by high values in areas with subtle and irregular variations and few coherent edges. Statistics were calculated with a 3 × 3 window size using ENVI software. Initially, the average of pre-event images was computed to create a single pre-event texture image. Subsequently, the texture difference between this image and the post-event texture was calculated. The optimal threshold value for texture difference analysis was determined to be 0.4, with pixels below this threshold classified as damaged.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="policy 3.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption"><strong>Figure (3):</strong> the GLCM texture difference and the corresponding optical images. (a–d) are selected examples that have significant texture changes, and those locations are shown on the WorldView-2 image</figcaption>
</figure>
</div>
</section>
<section id="results" class="level4" data-number="4.2.0.2">
<h4 data-number="4.2.0.2" class="anchored" data-anchor-id="results"><span class="header-section-number">4.2.0.2</span> Results</h4>
<p>The Sentinel-1 intensity analysis revealed flooding along the Irpin River. This area was excluded from the assessment as the flooding might be an indirect impact of war, but the focus is specifically on war-related damages to buildings and infrastructure. Significant building damage was concentrated in the northwestern part of Kyiv Oblast, particularly in Irpin, Bucha, and Hostomel. Building statistics, ranging from 85 m2 to 74,156 m2, were calculated using augmented OSM polygons and ArcGIS Desktop software. Most buildings identified by SAR intensity analysis were medium to large-scale structures. Smaller residential buildings were poorly detected, likely due to sensor limitations. High-rise buildings were flagged as damaged, but visual assessments using WorldView imagery did not confirm this finding. The WSF mask showed more false positives than the OSM mask.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="policy 4.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption"><strong>Figure (4)</strong>: comparison of Sentinel-1 damaged building results using two different masks (OSM&amp;WSF). (a) shows the SAR intensity-based results for the entire area. The locations (b–e) were selected as representative areas for comparison with the high-resolution WorldView image. The columns from left to right indicate the WorldView image (31 March 2022), OSM and WSF mask results of the damaged buildings. The scale shown in (b) is the same for (c–e).</figcaption>
</figure>
</div>
<p>The damage assessment results from the Sentinel-2 texture analysis revealed a flooded area along the Irpin River, similar to the SAR intensity analysis but with a smaller extent. Four representative areas were selected for comparison using the OSM mask versus the WSF built-up layer mask. The effects of these masks were less significant compared to the SAR intensity analysis, indicating fewer false positives in unmasked damage labels. Comparison with high-resolution WorldView images showed that the texture analysis mainly detected damages on large buildings with clear boundaries. However, buildings with dark roofs and smaller damaged buildings lacking distinct texture features compared to their surroundings were not captured in the analysis. Additionally, changes in intensity values of bright objects, representing either bare ground or tall structures showing different reflectance at different times, were misclassified as damaged buildings.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="policy 5.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure (5): the result of Sentinel-2 texture-based analysis for study region (a). (b–e) are comparison of Sentinel-2 damaged building results using two different masks (OSM&amp;WSF). The locations (b–e) are referenced in (a) and were selected as representative areas for comparison with the high-resolution WorldView image. The columns from left to right indicate the WorldView image (25 March 2022 &amp; 31 March 2022), OSM and WSF mask results of the damaged buildings. The scale shown in (b) is the same for (c–e).</figcaption>
</figure>
</div>
</section>
<section id="conclusion" class="level4" data-number="4.2.0.3">
<h4 data-number="4.2.0.3" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">4.2.0.3</span> Conclusion</h4>
<p>This study utilized Sentinel-1 and Sentinel-2 data to assess damage in Kyiv during the 2022 war. The analysis revealed concentrated damage in the northwestern Kyiv Oblast, particularly in cities like Bucha, Irpin, and Hostomel. When comparing damage detection algorithms, the analysis achieved 58% accuracy compared to UNOSAT verified damage, with 76% accuracy for larger buildings. The use of OpenStreetMap (OSM) and World Settlement Footprint (WSF) masks reduced false positives, but incomplete OSM footprints excluded some damage. Although texture analysis effectively detected large damaged buildings, it was less accurate for identifying small ones. Consequently, the study found that the intensity analysis performed better due to its ability to identify a wider range of building sizes accurately.</p>
</section>
<section id="other-methods-that-can-be-implemented-in-conflict-zones-using-remote-sensed-data" class="level4" data-number="4.2.0.4">
<h4 data-number="4.2.0.4" class="anchored" data-anchor-id="other-methods-that-can-be-implemented-in-conflict-zones-using-remote-sensed-data"><span class="header-section-number">4.2.0.4</span> <u><strong>Other methods that can be implemented in conflict zones using remote sensed data:</strong></u></h4>
<p><u><strong>Evaluation of Socio-Economic Consequences of war:</strong></u></p>
<p>This can be done through the use of couple of methods like:</p>
<ul>
<li><p>using satellite observations of nitrogen dioxide (NO2) and carbon dioxide (CO2) to monitor changes in human activities, such as fossil fuel combustion, power generation, and industrial production, during the conflict.</p></li>
<li><p>Distinct fire and thermal anomaly patterns due to military activities, contrasting with past agricultural-related fires. These patterns, can be confirmed by Sentinel 2 imagery, carry significant socio-economic implications, straining recovery efforts and requiring resource allocation based on various factors.</p></li>
<li><p>Satellite data from the VIIRS thermal imager utilization to monitor socio-economic developments, using Total Light Intensity (TLI) serving as an indicator of night illumination, reflecting economic activity, population density, and electricity consumption.</p></li>
</ul>
<p><u><strong>Monitor environment and air quality:</strong></u></p>
<ul>
<li><p>Employing NO2 and CO satellite data, filtering the data fields using a quality assurance index and binned into regular grids for reliability and comparison.</p></li>
<li><p>Detection of environmental changes: remote sensing enables the identification of alterations in natural settings, including deforestation, water pollution, shifts in vegetation cover, among others, potentially stemming from military activities.</p></li>
</ul>
<p>These are several ways in which remotely sensed data can contribute to urban expansion and guide post-war urban planning initiatives to construct a more resilient city.</p>
</section>
</section>
<section id="reflection" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="reflection"><span class="header-section-number">4.3</span> Reflection</h2>
<p>Conducting research on policies has deepened my understanding of how remote sensing data can drive transformation and development in urban areas, environmental monitoring, and socio-economic analysis, ultimately fostering economic growth. This comprehensive approach underscores the versatility of remote sensing and the various methods tailored to specific case studies. Despite its potential, remote sensing also poses limitations, such as restricted access to high-resolution data and potential inaccuracies in results. Nonetheless, I firmly believe that leveraging remote sensing methodologies and analyses can inform decision-making processes crucial for national and international development.</p>
</section>
<section id="reference" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="reference"><span class="header-section-number">4.4</span> Reference</h2>
<p><strong><em>War Related Building Damage Assessment in Kyiv, Ukraine, Using Sentinel-1 Radar and Sentinel-2 Optical Images</em></strong> (Aimaiti, Koch 2022).</p>
<p><strong><em>Satellites capture socioeconomic disruptions during the 2022 full‑scale war in Ukraine</em></strong> (Ialongo, Hakkaraine 2022).</p>
<p><strong><em>Use of Satellite Information for Evaluation of Socio-Economic Consequences of the War in Ukraine</em></strong> (Yelistratova, L. O., Apostolov, O. A. 2022).</p>
<p><strong><em>Monitoring and assessment of the scale of destruction by remote sensing methods during the war in Ukraine</em></strong> (Ye. Butenko, S. Petrychenko 2023).</p>
<p><strong><em>Remotely visible impacts on air quality after a year-round full-scale Russian invasion of Ukraine</em></strong> (Savenets, Osadchyi 2023).</p>
<p><strong><em>United Nations New Urban Agenda</em></strong></p>
<p><strong><em>Universal Sustainable Development Goals</em></strong></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./week 3.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Week 3 Correction: Refining the Lens</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./week 6.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Week 5 GEE: Mapping the world</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>